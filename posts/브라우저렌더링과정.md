---
title: 브라우저렌더링과정
description: 웹페이지가 렌더링 되는 과정
date: "2023-03-27"
category: network
published: true
tags: ["network", "브라우저렌더링과정"]
---

# 브라우저 렌더링 과정

## 간략한 순서

브라우저에서 웹페이지를 켜면 다음과 같은 순서로 렌더링이 이뤄진다. </br>

HTML, CSS, JS로드 ⇨ HTML 파싱 ⇨ CSS파싱 ⇨ 렌더트리 생성 ⇨ 레이아웃 ⇨ 페인트 ⇨ 자바스크립트 실행 </br>

#1. HTML, CSS 및 JavaScript 로드: 브라우저는 HTML, CSS 및 JavaScript 파일을 서버로부터 로드합니다. </br>

#2. HTML 파싱: 브라우저는 HTML 파일을 파싱하여 DOM(Document Object Model) 트리를 생성합니다. DOM 트리는 문서의 계층 구조를 나타내며, 모든 HTML 태그 및 해당 속성과 값, 텍스트 컨텐츠 등을 포함합니다.</br>

#3. CSS 파싱: 브라우저는 CSS 파일을 파싱하여 CSSOM(CSS Object Model) 트리를 생성합니다. CSSOM 트리는 각 CSS 규칙 및 해당 스타일 속성 값을 나타냅니다.</br>

#4. 렌더트리 생성: DOM 트리와 CSSOM 트리가 합쳐져 렌더트리(Render Tree)가 생성됩니다. 렌더트리는 화면에 실제로 그려지는 노드들로 구성됩니다. 스타일 정보가 있는 요소들만 렌더트리에 포함됩니다.</br>

#5. 레이아웃: 렌더트리 내의 각 노드는 레이아웃(배치) 위치와 크기를 계산합니다.</br>

#6. 페인트: 렌더트리 내의 모든 노드에 대해 실제 픽셀을 그리는 페인트 작업이 수행됩니다.</br>

#7. 자바스크립트 실행: 페이지가 완전히 로드되면 자바스크립트가 실행됩니다. 자바스크립트는 DOM 트리를 변경하고 CSSOM 트리를 수정할 수 있으며, 이로 인해 다시 렌더트리가 생성됩니다. 이 과정을 '리플로우' 또는 '리페인트'라고 합니다.</br>

---

## 상세한 설명

### HTML, CSS, JS 로드

- 브라우저는 웹페이지를 불러오기 위해 서버로부터 HTML, CSS, JavaScript 파일을 다운로드 합니다.
- 다운로드된 파일은 브라우저 캐시에 저장됩니다.

### HTML파싱

- 브라우저는 HTML을 파싱하여 DOM 트리를 생성합니다.
- 파싱은 다음과 같은 단계로 이뤄집니다.
  - #1. HTML 파일의 시작 태그를 읽어 DOM트리의 루트 노드를 생성한다.
  - #2. HTML 태그를 읽어 해당 태그를 DOM트리의 적절한 위치에 추가한다.
  - #3. HTML 태그의 속성값을 읽어 해당 값을 DOM노드에 설정한다.
  - #4. HTML 태그 내의 텍스트를 읽어 해당 텍스트를 DOM 노드에 추가한다.
  - #5. HTML 태그의 끝 태그를 읽어 해당 태그를 DOM트리에 추가한다.

### CSS 파싱

- 브라우저는 CSS파일을 파싱하여 CSSOM 트리를 생성합니다.
- 파싱은 다음과 같은 단계로 이뤄집니다.
  - #1. 브라우저는 CSS규칙을 읽어 해당 규칙을 CSSOM트리에 추가한다.
  - #2. CSS 속성값을 읽어 해당 값을 CSSOM노드에 설정한다.
  - #3. 브라우저는 CSS 규칙의 우선순위를 계싼하여 CSSOM 트리에 반영한다.

### 렌더트리 생성

- DOM트리와 CSSOM 트리가 합쳐져 렌더트리가 생선됩니다.
- 렌더트리는 화면에 실제로 그려지는 노드들로만 구성됩니다.
- 렌더트리에는 스타일 정보가 있는 요소들만 포함됩니다.
- 렌더트리는 DOM 트리의 일부 요소만을 포함할 수 있습니다.

### 레이아웃

- 렌더트리 내의 각 노드는 레이아웃 위치와 크기를 계산합니다.
- 레이아웃은 다음과 같은 단계로 이루어집니다.
  - #1. 루트 요소의 크기 계산
    - HTML문서의 루트요소는 대개 `<html>`요소이다.
    - 브라우저는 루트 요소의 크기를 계산한다. 이 크기는 브라우저의 뷰포트 크기에 따라 결정된다.
  - #2. 블록 레벨 요소의 위치 계산
    - 블록 레벨 요소는 대개 `<div>`, `<p>`, `<h1>`과 같은 요소들이다.
    - 브라우저는 블록 레벨 요소의 위치를 계산한다. 이 위치는 이전 블록 요소의 위치와 해당 요소의 크기, 여백 등을 고려하여 결정된다.
  - #3. 인라인 요소의 위치 계산
    - 인라인 요소는 대개 `<span>`, `<a>`와 같은 요소들이다.
    - 브라우저는 인라인 요소의 위치를 계산한다. 이 위치는 이전 인라인 요소의 위치와 해당 요소의 크기, 여백등을 고려하여 결정된다.
  - #4. 블록 레벨 요소의 크기 계산
    - 블록 레벨 요소의 크기는 해당 요소에 포함된 컨텐츠의 크기와 여백, 테두리, 패딩 등의 스타일 정보를 고려하여 계산된다.
  - #5. 인라인 요소의 크기 계산
    - 인라인 요소의 크기는 해당 요소에 포함된 컨텐츠의 크기와 여백, 테두리, 패딩 등의 스타일 정보를 고려하여 계산된다.
  - #6. 블록 레벨 요소의 높이 계산
    - 블록 레벨 요소의 높이는 해당 요소에 포함된 컨텐츠와 패딩, 테두리, 여백 등의 높이를 고려하여 계산된다.
    - 만약 해당 요소의 높이가 명시적으로 지정되어 있지 않은 경우, 브라우저는 컨텐츠의 높이에 따라 자동으로 높이를 계산한다.
    - 만약 블록 레벨 요소가 자식 요소를 포함하고 있다면, 해당 자식 요소들의 높이를 계산한 후 부모 요소의 높이를 결정한다.
  - #7. 블록 레벨 요소의 위치 조정
    - 블록 레벨 요소의 위치는 이전 요소와의 간격, 상위 요소와의 간격 등을 고려하여 조정된다.
  - #8. 인라인 요소의 위치 조정
    - 인라인 요소의 위치는 이전 요소와의 간격, 상위 요소와의 간격 등을 고려하여 조정된다.
  - #9. 레이아웃 최적화
    - 브라우저는 레이아웃 과정에서 발생하는 계산 비용을 최소화하기 위해 최적화 기법을 사용한다.
    - 대표적인 최적화 기법으로는 리플로우를 방지하기 위해 CSS애니메이션을 transform속성으로 대체하는 것이 있다.

### 페인팅

- 브라우저는 렌더트리의 각 노드를 실제 화면에 그리는 작업을 수행합니다.
- 이 과정에서 노드의 배경, 테두리, 글꼴, 색상등의 스타일 정보가 사용됩니다.
- 브라우저는 렌더트리의 각 노드를 순서대로 그리면서 화면을 그려갑니다.
- 페인팅은 CPU와 GPU의 협력적인 작업을 통해 이뤄집니다.

### 리플로우와 리페인트

- 레이아웃과 페인팅은 많은 비용이 드는 작업이므로 최소화 하는것이 중요합니다.
- 브라우저는 레이아웃과 페인팅을 최적화 하기 위해 리플로우와 리페인트 라는 개념을 사용합니다.
- 리플로우는 노드의 레이아웃 정보가 변경될 때 발생하는 작업으로, 해당 노드를 포함한 다른 노드들의 레이아웃 정보를 재계산 해야 합니다.
- 리페인트는 노드들의 스타일 정보가 변경될 때 발생하는 작업으로, 해당 노드를 포함한 다른 노드들의 페인팅 정보를 재계산해야 합니다.

### 자바스크립트 실행

- 브라우저는 HTML, CSS, JS파일을 다운로드한 후 JS코드를 실행합니다.
- 자바스크립트는 브라우저의 메인 스레드에서 실행되므로, 실행이 끝나기 전까지 다른 작업을 수행할 수 없습니다.
- 자바스크립트 실행이 길어질 경우, 브라우저의 반응성이 떨어지는 문제가 발생할 수 있습니다.
